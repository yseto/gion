function categories_link(a){a=a.replace("/#",""),jQuery.isNumeric(a)&&(cat_idx_selected=a,cat_list(a),$(".categories_link").removeClass("active"),get_contents(a),0==a?$(".categories_link:first").addClass("active"):$("#categories_link_"+a).addClass("active"),selection=0,moveselector())}function cat_list(a){$("#cat_list").empty(),jQuery.ajax({type:"POST",url:"/inf/get_categories",datatype:"json",async:!1,success:function(b){var c=[],d=0,e=void 0;jQuery.each(b,function(){var b=$("<a>").addClass("categories_link list-group-item").attr({id:"categories_link_"+this.i,href:"/#"+this.i}).text(this.n).append($("<span>").addClass("badge hidden-sm").text(this.c));$("#cat_list").append(b),c[d]="/#"+this.i,d++,a==this.i&&(e=d)});var f;void 0===e?(f=d-1,cat_idx_prev=c[f],cat_idx_next=1==d?c[0]:c[1]):(f=e-2,void 0===c[f]?(f=d-1,cat_idx_prev=c[f]):cat_idx_prev=c[f],f=e+0,cat_idx_next=void 0===c[f]?c[0]:c[f])}})}function get_contents(a){$("#contents_view_box").prepend($("<p>").text("Please Wait...").addClass("alert alert-info")),jQuery.ajax({type:"POST",url:"/inf/get_entries",data:{cat:a},datatype:"json",success:function(a){entries(a),moveselector()}})}function entries(a){if($("#contents_view_box").empty(),jQuery.each(a,function(){var a=$("<div>");a.addClass("tw panel panel-default"),a.attr({id:this.g});var b="[nothing title...]";this.t.length>0&&(b=this.t);var c=$("<h4>").addClass("viewpage").append($("<a>").attr({href:this.u,target:"blank",rel:"noreferrer"}).text(b).click(function(){return window.open(this.href),!1}).css("color","#333"));2==this.r&&c.css("background-color","#6cf"),a.append(c),a.append($("<p>").text(this.d));var d=$("<p>").addClass("add pull-right").append($("<span>").addClass("glyphicon glyphicon-ok")).append(" Pin!");2!=this.r&&d.hide(),a.append($("<a>").addClass("pinlink hidden-md hidden-lg btn btn-info btn-sm").text("Pin!"));var e=$("<div>").addClass("text-right").prepend($("<br>").addClass("hidden-md hidden-lg")),f=this.s;$.each(service_state,function(a){e.append($("<span>").css("margin-left","1em")),e.append($("<button>").addClass("service btn btn-danger btn-sm").text(a).data("service",a).data("url",f))}),a.append(e),a.append(d),a.append($("<p>").text(this.p)),$("#contents_view_box").append(a)}),0==a.length){var b=$("<div>").addClass("tw panel panel-default");b.append($("<h3>").text("Nothing Entries.")),$("#contents_view_box").append(b)}}function item_pin(){var a=$(".tw:eq("+selection+")");a.children(".add").toggle(),post_pin(a)}function post_pin(a){jQuery.ajax({type:"POST",url:"/inf/set_pin",data:{flag:is_toggle_pin(a),pinid:encodeURI(a.attr("id"))},datatype:"text",success:function(){}})}function item_view(){$(".tw:eq("+selection+") > .viewpage > a").click()}function item_prev_focus(){prev_selection=selection,selection--,0>selection&&(selection=0),moveselector()}function item_next_focus(){selection==$(".tw").length-1&&$(".tw").length-1>0&&selection--,prev_selection=selection,selection++,$(".tw").length-1<selection&&(selection=$(".tw").length-1),moveselector()}function moveselector(){var a=-80,b=".tw:eq("+selection+")";return selection>=0&&$(".tw").length>selection?($(b).css("border-color",colour_s),prev_selection!=selection&&$(".tw:eq("+prev_selection+")").css("border-color",colour),void $($.browser.msie||$.browser.mozilla||$.browser.opera&&!$.browser.webkit?"html":"body").animate({scrollTop:$(b).offset().top+a},0)):void(selection=0)}function is_toggle_pin(a){var b=a.children("h4");return"block"==a.children(".add").css("display")?(b.css("background-color","#6cf"),1):(b.css("background-color","inherit"),0)}function categories_next(){void 0!=cat_idx_next&&categories_link(cat_idx_next)}function categories_prev(){void 0!=cat_idx_prev&&categories_link(cat_idx_prev)}function item_service(a){for(var b=$(".tw:eq("+selection+") * "),c=b.children(".service"),d=0;d<c.length;d++)c.eq(d).text()==a&&c.eq(d).click()}var colour_s="#339",colour="#999",selection=0,prev_selection=0,service_state={};$(window).on("load",function(){jQuery.ajaxSetup({cache:!1,error:function(){$("#myModal").modal("show")}}),service_state={},jQuery.ajax({type:"POST",url:"/manage/get_connect",datatype:"json",success:function(a){return null==a.e?!1:void jQuery.each(a.e,function(){service_state[this.service]=1})},error:function(){}}),cat_list(),$(".categories_link").removeClass("active"),get_contents(0),$(".categories_link:first").addClass("active"),$("#pinlist").hide(),moveselector()}),$("#cat_list").on("click",".categories_link",function(a){categories_link($(this).attr("href")),a.preventDefault()}),$(document).keypress(function(a){switch(a.preventDefault(),a.keyCode||a.which){case 97:categories_prev();break;case 115:categories_next();break;case 111:$("#toggle_pinlist").click();break;case 112:item_pin();break;case 114:categories_link(cat_idx_selected);break;case 107:item_prev_focus();break;case 106:item_next_focus();break;case 118:item_view();break;case 108:item_service("pocket")}}),$("#toggle_pinlist").click(function(){"block"!=$("#pinlist").css("display")&&jQuery.ajax({type:"POST",url:"/inf/get_pinlist",datatype:"json",async:!1,success:function(a){var b=0;$("#pinlist_ul").empty(),jQuery.each(a,function(){$("#pinlist_ul").append($("<a>").attr({href:this.u}).text(this.t).addClass("list-group-item")),b++}),$("#pincount").text(b)}}),$("#pinlist").toggle()}),$("#remove_all_pin").click(function(){confirm("Are you sure?")&&jQuery.ajax({type:"POST",url:"/inf/remove_all_pin",datatype:"json",success:function(){cat_list(),$(".categories_link").removeClass("active"),get_contents(0),$(".categories_link:first").addClass("active"),selection=0,moveselector()}})});var cat_idx_prev="",cat_idx_next="",cat_idx_selected="0";$(document).on("click",".pinlink",function(){var a=$(this).closest("div");a.children(".add").toggle(),post_pin(a)}),$(document).on("click",".service",function(){var a=$(this);jQuery.ajax({type:"POST",url:"/api/"+$(this).data("service")+"/post",datatype:"json",data:{service:$(this).data("service"),url:$(this).data("url")},success:function(b){"ok"==b.e&&a.text("posted").attr("disabled","disabled")}})});var nav=$(".nav");nav.on("click",'a[href="#home"]',function(){location.href="/"}),nav.on("click",'a[href="#entries"]',function(){location.href="/entries/"}),nav.on("click",'a[href="#addasite"]',function(){location.href="/add/"}),nav.on("click",'a[href="#subscription"]',function(){location.href="/subscription/"}),nav.on("click",'a[href="#settings"]',function(){location.href="/settings/"}),nav.on("click",'a[href="#logout"]',function(){location.href="/?logout=1"}),$("#helpmodal").click(function(){$("#helpModal").modal("show")}),$("#returntop").click(function(){$("html,body").animate({scrollTop:0},"fast")});