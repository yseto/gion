<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Gion</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui">
    <meta name="author" content="Gion">
    <meta name="referrer" content="no-referrer">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
        overflow-y:scroll;
      }
      .tw {
        margin:0 0 5px !important;
        padding:0 10px;
      }
      .tw--active {
        border-color: #339 !important;
      }
      #cat_list .list-group-item, #pinlist_ul .list-group-item {
        padding:4px 10px;
        cursor: pointer;
      }
      .viewpage__pinned {
        background-color: #6cf;
      }
      .navbar-nav li {
        cursor:pointer;
      }
    </style>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container" id="app" data-nopin="[% nopinlist | __boolean %]"></div>

<script type="text/x-template" id="tmpl_header">
  <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
	    <span class="navbar-brand">Gion</span>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li v-bind:class="{ active: $root.currentRoute === '' }">
            <a v-on:click="$root.go('')"><span class="glyphicon glyphicon-home"></span> Home</a>
          </li>
          <li v-bind:class="{ active: $root.currentRoute === '#entry' }">
            <a v-on:click="$root.go('#entry')"><span class="glyphicon glyphicon-inbox"></span> Read</a>
          </li>
          <li v-bind:class="{ active: $root.currentRoute === '#add' }">
            <a v-on:click="$root.go('#add')"><span class="glyphicon glyphicon-plus-sign"></span> Add a Site</a>
          </li>
          <li v-bind:class="{ active: $root.currentRoute === '#subscription' }">
            <a v-on:click="$root.go('#subscription')"><span class="glyphicon glyphicon-list"></span> Subscription</a>
          </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li v-bind:class="{ active: $root.currentRoute === '#settings' }">
            <a v-on:click="$root.go('#settings')"><span class="glyphicon glyphicon-wrench"></span> Settings</a>
          </li>
          <li class="hidden-sm">
            <a style="cursor:pointer;" v-on:click="$root.help">
              <i class="glyphicon glyphicon-question-sign"></i> Help
            </a>
          </li>
          <li><a href="/logout"><span class="glyphicon glyphicon-off"></span> Logout</a></li>
        </ul>
      </div><!--/.navbar-collapse -->
    </div>
  </div>
</script>

<script type="text/x-template" id="tmpl_add_app">
<div>
<gion-header></gion-header>
<div class="container">
  <div class="row">
    <h4>Subscription</h4>
    <form class="form-horizontal" id="form">
      <div class="form-group">
        <label class="col-sm-2 control-label" for="inputURL">URL(Web Page)</label>
        <div class="col-sm-4">
          <input type="text" id="inputURL" placeholder="URL" class="form-control" v-model="field.url">
        </div>
        <div class="col-sm-4">
          <a class="btn btn-info" v-on:click.prevent="feed_detail">Get Detail</a>
          <span v-if="search_state" class="glyphicon glyphicon-pencil"></span>
        </div>
      </div>
      <div class="form-group">
       <label class="col-sm-2 control-label" for="inputTitle">Title</label>
        <div class="col-sm-4">
          <input type="text" id="inputTitle" placeholder="Title" class="form-control" v-model="field.title">
        </div>
      </div>
      <div class="form-group">
       <label class="col-sm-2 control-label" for="inputRSS">URL(Subscription)</label>
        <div class="col-sm-4">
          <input type="text" id="inputRSS" placeholder="RSS" class="form-control" v-model="field.rss">
        </div>
      </div>
      <div class="form-group">
       <label class="col-sm-2 control-label" for="selectCat">Categories</label>
        <div class="col-sm-4">
          <select class="form-control" id="selectCat" placeholder="Choose Category" v-model="category">
            <option v-for="item in list" v-bind:value="item.id">{{ item.name }}</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-10 col-sm-offset-2">
          <button type="button" v-on:click.prevent="register_feed" class="btn btn-primary">Register</button>
          <span v-if="success_feed">Thanks! add your request.</span>
        </div>
      </div>
    </form>
    <hr/>
    <h4>Categories</h4>
    <form class="form-horizontal" id="form">
      <div class="form-group">
        <label class="col-sm-2 control-label" for="inputCategoryName">Name</label>
        <div class="col-sm-4">
          <input type="text" class="form-control" id="inputCategoryName" placeholder="Name">
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-10 col-sm-offset-2">
          <button type="button" v-on:click.prevent="register_category" class="btn btn-primary">Register</button>
          <span id="return_cat"></span>
        </div>
      </div>
    </form>
  </div>
  <p class="clearfix hidden-lg hidden-md"><a class="btn btn-default pull-right" v-on:click="$root.returntop">Back to Top</a></p>
</div><!--/container-->
</div>
</script>

<script type="text/x-template" id="tmpl_home">
<div>
<gion-header></gion-header>
<div class="container">
  <div class="row">
    <div class="panel panel-info">
      <div class="panel-heading">
        PinList <span class="badge">{{ list.length }}</span>
      </div>
      <ul class="list-group">
        <li class="list-group-item" v-for="(item, index) in list">
          <a class="glyphicon glyphicon-check" style="cursor:pointer;" v-bind:data-guid="item.guid" v-bind:data-index="index" v-on:click="apply_read"></a> <span>{{ item.update_at }}</span> <a v-bind:href="item.url" target="blank">{{ item.title }}</a>
        </li>
      </ul>
    </div>
  <p class="clearfix hidden-lg hidden-md"><a class="btn btn-default pull-right" v-on:click="$root.returntop">Back to Top</a></p>
  </div>
</div>
</div>
</script>

<script type="text/x-template" id="tmpl_reader">
<div>
<gion-header></gion-header>
<div class="container">
  <div class="row">
    <div class="col-sm-3">
      <!-- PINLIST -->
      <p>
        <a class="btn btn-small btn-info" v-on:click.prevent="pin_list_switch"><span class="glyphicon glyphicon-pushpin"></span> Pin List</a>
        <a class="btn btn-small btn-default" v-on:click.prevent="pin_list_clean"><span class="glyphicon glyphicon-remove"></span> Remove All Pin</a>
      </p>

      <div v-if="pin_list_state == true" class="panel panel-default" id="pinlist">
        <div class="panel-heading">PinList <span class="badge badge-info">{{ pin_list.length }}</span></div>
        <div class="list-group" v-for="item in pin_list">
          <a class="list-group-item" v-bind:href="item.url">{{ item.title }}</a>
        </div>
      </div>

      <!-- CATEGORIES -->
      <div class="panel panel-default" id="cat_list">
        <div class="panel-heading"><span class="glyphicon glyphicon-list"></span>Categories</div>
        <div class="list-group">
          <a 
             class="list-group-item"
             v-for="(item, index) in category_list"
             v-bind:class="{ active: index == category.selected() }"
             v-on:click.prevent="category.set(category_list, index);content_update();"
             >{{ item.n }} <span class="badge hidden-sm">{{ item.c }}</span></a>
        </div>
      </div>
    </div>
  

    <!-- CONTENT -->
    <div class="col-sm-9" id="contents_list">
      <div class="tw panel panel-default" v-if="content_list === undefined">
        <h3>Nothing Entries.</h3>
      </div>
      <div v-for="(item, index) in content_list">
        <div class="tw panel panel-default" v-bind:class="{ 'tw--active': index == content.selected() }">
          <h4 class="viewpage" v-bind:class="{ viewpage__pinned : item.readflag == 2 }">
            <a v-bind:href="item.url" target="blank" rel="noreferrer" style="color: #333;">
            <span v-if="item.title.length > 0">{{ item.title }}</span>
            <span v-else>[nothing title...]</span>
            </a>
          </h4>
          <p>{{ item.description }}</p>

          <br class="hidden-md hidden-lg">
          <div class="text-right">
            <span style="margin-left:1em;" v-for="(undef, button) in external_api">
              <button
                class="btn btn-success btn-sm"
                v-bind:data-service="button"
                v-bind:data-url="item.raw_url"
                v-on:click.prevent="add_bookmark"
              >{{ button }}</button>
            </span>
          </div>
          <div>
            <p
              v-if="item.readflag == 2"
              class="pull-right visible-md visible-lg"
              >
              <span class="glyphicon glyphicon-ok"></span> Pin!
            </p>
            <a
              class="hidden-md hidden-lg btn btn-info btn-sm"
              v-on:click.prevent="toggle_pin(index)"
            >Pin!</a> <!-- //スマホ用ピン立て -->
          </div>
          <p>{{ item.date + " - " + item.site_title}}</p>
        </div>
      </div>
    </div>

  </div><!--/row-->

<ul class="pager hidden-lg hidden-md">
    <li class="previous"><a v-on:click.prevent="category_previous" class="btn btn-default">&lt;&lt; Category Back</a></li>
    <li class="next"><a v-on:click.prevent="category_next" class="btn btn-default">Category Next &gt;&gt;</a></li>
</ul>

  <p class="clearfix hidden-lg hidden-md"><a class="btn btn-default pull-right" v-on:click="$root.returntop">Back to Top</a></p>
</div><!--/.container-->
</div>
</script>

<script type="text/x-template" id="tmpl_settings">
<div>
<gion-header></gion-header>
<div class="container">
  <div>
    <form role="form">
      <div class="row">
        <div class="form-group">
          <label class="control-label col-sm-2" for="numentry">表示件数の上限</label>
          <div class="col-sm-10">
            <input type="number" id="numentry" v-model="numentry" placeholder="0で無制限">
            <span class="help-block">一度に表示する件数の上限を設定できます。</span>
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2" for="numsubstr">概要の文字数制限</label>
          <div class="col-sm-10">
            <input type="number" id="numsubstr" v-model="numsubstr" placeholder="0で無制限">
            <span class="help-block">概要の文字数の上限を設定できます。</span>
          </div>
        </div>
        <div class="form-group">
          <label class="control-label col-sm-2">その他の設定</label>
          <div class="col-sm-10">
            <div class="checkbox">
              <label><input type="checkbox" v-model="checked" value="noreferrer"/>リファラを抑制する</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" v-model="checked" value="nopinlist"/>Home画面で、ピンリストを表示しない</label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-10 col-sm-offset-2">
            <a class="btn btn-primary" v-on:click="apply">OK</a>
            <span v-if="finished">Thanks. Setting your values.</span>
          </div>
        </div>
      </div>
      <hr/>
      <div class="row">
        <div class="form-group">
          <label class="control-label col-sm-2">連携設定</label>
          <div class="col-sm-10">
            <table class="table table-condenced">
            <tr>
              <th>サービス</th>
              <th>状態</th>
            </tr>
            <template v-for="(value, service) in external_api">
              <tr v-if="value.state == false">
                <td>{{ value.name }}</td>
                <td>
                  <a class="btn btn-default btn-xs" v-bind:href="'/external_api/'+service+'/connect'">
                    <span class="glyphicon glyphicon-link"></span> 連携する
                  </a>
                </td>
              </tr>
              <tr v-else>
                <td>{{ value.name }} - {{ value.username }}</td>
                <td>
                  <a class="btn btn-default btn-xs" v-bind:href="'/external_api/'+service+'/disconnect'">
                    <span class="glyphicon glyphicon-remove"></span> 連携の解除
                  </a>
                </td>
              </tr>
            </template>
            </table>
          </div>
        </div>
      </div><!--/row-->
    </form>
  </div>
  <hr>
  <h4>パスワード設定</h4>
  <div class="row">
    <form role="form" id="form2">
      <div class="form-group">
        <label class="control-label col-sm-3" for="password_old">今のパスワード</label>
        <div class="col-sm-13">
          <input type="password" id="password_old" v-model="password_old" placeholder="8文字以上">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-3" for="password">新しいパスワード</label>
        <div class="col-sm-13">
          <input type="password" id="password" v-model="password" placeholder="8文字以上">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-3" for="passwordc">新しいパスワード(確認)</label>
        <div class="col-sm-13">
          <input type="password" id="passwordc" v-model="passwordc" placeholder="8文字以上">
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-13 col-sm-offset-3">
          <a class="btn btn-primary" v-on:click.prevent="update_password">Password Change.</a>
        </div>
      </div>
    </form>
  </div><!--/row-->
  <hr/>

<template v-if="[% r.is_admin | __boolean %]">
  <h4>ユーザー追加</h4>
  <div class="row">
    <form role="form" id="form2">
      <div class="form-group">
        <label class="control-label col-sm-3" for="username">ユーザー名</label>
        <div class="col-sm-13">
          <input type="text" id="username" v-model="username">
        </div>
      </div>
      <div class="form-group">
        <label class="control-label col-sm-3" for="user_password">パスワード</label>
        <div class="col-sm-13">
          <input type="password" id="user_password" v-model="user_password" placeholder="8文字以上">
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-13 col-sm-offset-3">
          <a class="btn btn-primary" v-on:click="create_user">Create User</a>
        </div>
      </div>
    </form>
  </div><!--/row-->
  <hr/>
</template>

  <h4>OPML</h4>

  <div class="row">
    <div class="form-group">
      <label class="control-label col-sm-3">エクスポート</label>
      <div class="col-sm-13">
        <a class="btn btn-info" href="../opml/opml_export">エクスポート</a>
      </div>
    </div>

    <form action="../opml/opml_import" method="post" role="form" enctype="multipart/form-data">
      [% r.csrf_field %]
      <div class="form-group">
        <label class="control-label col-sm-3">インポート</label>
        <div class="col-sm-13">
            <input type="file" name="file">
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-13 col-sm-offset-3">
            <button type="submit" class="btn btn-default">インポート</button>
        </div>
      </div>
    </form>
  </div><!--/row-->
  <hr/>
  <p class="clearfix hidden-lg hidden-md"><a class="btn btn-default pull-right" v-on:click="$root.returntop">Back to Top</a></p>
</div><!--/container-->
</div>
</script>

<script type="text/x-template" id="tmpl_subscription">
<div>
<gion-header></gion-header>
<div class="container">
  <div class="row">
    <table class="table table-condensed" style="table-layout: fixed;">
      <tbody>
        <tr v-for="(item, index) in lists">
          <th v-if="item.type == 'title'">
            {{ item.name }}
            <span class="pull-right">
              <button
                class="btn btn-danger btn-xs"
                v-on:click="remove_it(item.id, 'category', item.name)"
                >
                削除
              </button>
            </span>
          </th>
          <td v-else style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
              <a class="pull-left btn btn-link btn-xs" v-bind:href="item.siteurl" v-bind:title="item.title" target="blank">
                <span class="visible-xs">{{ item.title }}</span><!-- cutting need -->
                <span class="visible-sm visible-md visible-lg">{{ item.title }}</span>
                <span v-if="item.http_status < -5 || item.http_status == '404'" class="badge">取得に失敗しました</span>
              </a> 
              <span class="pull-right">
                <!-- data-name, data-target no use ? -->
                <button
                  class="btn btn-info btn-xs"
                  v-on:click="change_category(item.id, item.category_id)"
                  >
                 移動 
                </button>
                &nbsp;
                <button
                  class="btn btn-danger btn-xs"
                  v-on:click="remove_it(item.id, 'entry', item.title)"
                  >
                  削除
                </button>
              </span>

          </td>
        </tr>
      </tbody>
    </table>
  </div><!--/row-->
  <hr/>
 
  <div class="modal fade" id="categoryModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Change: Categories</h4>
        </div>
        <div class="modal-body">
          <label class="control-label" for="selectCat">Categories</label>
          <select v-model="field_category" class="form-control" placeholder="Choose Category">
            <option v-for="item in category" v-bind:value="item.id">{{ item.name }}</option>
          </select>
        </div>
        <div class="modal-footer">
          <a class="btn btn-success" v-on:click="submit">OK</a>
          <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  <p class="clearfix hidden-lg hidden-md"><a class="btn btn-default pull-right" v-on:click="$root.returntop">Back to Top</a></p>
</div><!--/.container-->
</div>
</script>

<div class="modal fade" id="helpModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Help</h4>
      </div>
      <div class="modal-body">
        <p>Homeでは、PinListに追加したエントリの一覧が表示されます。</p>
        <p><span class="glyphicon glyphicon-check"></span> をクリックすると該当のエントリのピンを外すことができます。</p>
        <p><span class="glyphicon glyphicon-check"></span> のとなりに表示されている時間はピンを立てた時間です。</p>

        <hr>

        <p>URLに巡回したいWebサイトのアドレスを入力して、<a class="btn btn-info">Get Detail</a>をクリックすると、必要な情報を取得します。</p>
        <p>この方法で取得できない場合は、Webページのデータを確認してください。RSSを配信していない可能性があります。</p>
        <hr/>
        <p>カテゴリを増やしたい場合は、下の入力欄にカテゴリの名前を入力してください。この時追加したカテゴリはすぐに、サイト登録でお使いになれます。</p>

        <hr>

        <table class="table table-striped table-bordered">
          <tr><th>Key</th><th>Description</th></tr>
          <tr><th>A</th><td>一つ前のカテゴリ</td></tr>
          <tr><th>S</th><td>一つ次のカテゴリ</td></tr>
          <tr><th>K</th><td>一つ前のアイテムを選択する</td></tr>
          <tr><th>J</th><td>一つ次のアイテムを選択する</td></tr>
          <tr><th>O</th><td>ピンリストを開く、閉じる</td></tr>
          <tr><th>P</th><td>ピンを立てる、外す</td></tr>
          <tr><th>V</th><td>アイテムを開く</td></tr>
          <tr><th>R</th><td>ページを再読み込みする</td></tr>
        </table>

        <hr>

        <p>変更ボタンで巡回先のカテゴリを移動させることができます。</p>
        <p>削除ボタンで巡回先を巡回対象から外すことができます。</p>
        <p>カテゴリを削除した場合、カテゴリ以下に登録されている巡回先も同時に削除されます。</p>

        <hr>
      </div>
      <div class="modal-footer">
        <button class="btn btn-inverse" data-dismiss="modal" aria-hidden="true">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Sorry</h4>
      </div>
      <div class="modal-body">
        <p>申し訳ありません。エラーが発生しました。<br/>管理者にご連絡ください。</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Close</button>
      </div>
    </div>
  </div>
</div>

<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.2.1/vue.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-browser/0.0.6/jquery.browser.min.js"></script>
<script src="/static/gion.js"></script>
</body>
</html>

